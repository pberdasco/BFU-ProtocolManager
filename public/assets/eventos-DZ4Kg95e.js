import{r as c,j as i}from"./index-CUZSR6jm.js";import{G as p}from"./GenericGrid-a7weaJcj.js";import{a as u}from"./apiResource-X6nNJMGp.js";import{u as y}from"./useQuery-B74RDuhm.js";import{S as m}from"./select-box-Duxp4ywA.js";import"./data-grid-CGD_RL6S.js";import"./m_export-CLlCNyBP.js";import"./localization-wC_hBY2P.js";import"./excelExport-B0wlWVfN.js";import"./exceljs.min-Bu-WEMN3.js";import"./export_merged_ranges_manager-D8l_JMl9.js";const b=async()=>(await new u("subproyectos").fetch({sort:[{selector:"codigo",desc:!1}]})).data.map(e=>({id:e.id,display:`${e.codigo}: ${e.nombreLocacion}`,codigo:e.codigo})),f=(o,t,e)=>{o.data.subproyectoId=e;const a=t.find(s=>s.id===e);a&&(o.data.subproyecto=a.codigo),o.data.id===void 0&&(o.data.soloMuestras=!1)},S=(o,t)=>{o.changes.length>0&&o.changes.forEach(e=>{(e.type==="insert"||e.type==="update")&&(e.data.subproyectoId||(e.data.subproyectoId=t),"cadenasCustodiaPDFLink"in e.data||(e.data.cadenasCustodiaPDFLink=null)),e.type==="remove"&&console.log("Eliminando elemento con key:",e.key)})};function L(){const{data:o,isLoading:t,error:e}=y({queryKey:["subproyectos"],queryFn:b}),[a,s]=c.useState(null),d=[{dataField:"id",width:90,caption:"ID",allowFiltering:!1,allowSearch:!1},{dataField:"subproyecto",caption:"Subproyecto"},{dataField:"fecha",caption:"Fecha",dataType:"date",format:"dd/MM/yyyy",validationRules:[{type:"required",message:"La fecha es obligatorio"}]},{dataField:"nombre",caption:"Nombre",validationRules:[{type:"required",message:"El nombre es obligatorio"}]},{dataField:"soloMuestras",caption:"Solo niveles",dataType:"boolean"}],n={colCount:8,items:[{dataField:"id",colSpan:1,editorOptions:{disabled:!0}},{dataField:"subproyecto",colSpan:2,editorOptions:{disabled:!0}},{itemType:"empty",colSpan:3},{dataField:"soloMuestras",colSpan:1,label:{text:"Solo niveles"},editorType:"dxCheckBox"},{itemType:"empty",colSpan:1},{dataField:"fecha",colSpan:2},{dataField:"nombre",colSpan:5,editorOptions:{maxLength:45}},{itemType:"empty",colSpan:1}]};return t?i.jsx("div",{children:"Cargando datos..."}):e?i.jsx("div",{children:"Error al cargar datos del subproyecto"}):i.jsxs("div",{children:[i.jsx("div",{style:{marginBottom:"20px"},children:i.jsx(m,{dataSource:o,displayExpr:"display",valueExpr:"id",label:"Seleccione un subproyecto",labelMode:"outside",searchEnabled:!0,onValueChanged:r=>s(r.value)})}),a&&i.jsx(p,{title:"Eventos Muestreo",resource:"eventomuestreo",columns:d,keyExpr:"id",editable:!0,form:n,size:"mediumShort",externalFilter:["subproyectoId","=",a],onSaving:(r,l)=>S(r,l),onInitNewRow:r=>f(r,o,a)})]})}export{L as default};
