import{r as c,j as t}from"./index-BkPAYC4t.js";import{G as b}from"./GenericGrid-WdsChOSO.js";import"./apiResource-CLOj6waL.js";import{S as E}from"./select-box-BFfHfwAx.js";import{u as R}from"./autAplicacion-BkOW8qRK.js";import{u as A}from"./compuestos-BTtq0jfa.js";import{u as I}from"./um-DiDMn0L_.js";import"./data-grid-BNyC2bq0.js";import"./m_export-BPchivYo.js";import"./localization-D8w3L9Lu.js";import"./excelExport-D3xDkmLP.js";import"./exceljs.min-DwoinmsD.js";import"./export_merged_ranges_manager-yK1-asbs.js";import"./useQuery-BAPTrFW-.js";const C=(o,i,a)=>{o.data.autAplicacionId=a;const r=i.find(d=>d.id===a);r&&(o.data.autAplicacion=r.id,o.data.valorReferencia=0)},M=(o,i)=>{o.changes.length>0&&o.changes.length>0&&o.changes.forEach(a=>{(a.type==="insert"||a.type==="update")&&(a.data.autAplicacionId||(a.data.autAplicacionId=i)),a.type==="remove"&&console.log("Eliminando elemento con key:",a.key)})};function D(){function o(e){const n=i.find(l=>l.id===e),h=d.filter(l=>l.matrizCodigo===n.matrizId);v(h),x(e)}const{autAplicacion:i,isLoadingAutAplicacion:a,errorAutAplicacion:r}=R(),{compuestos:d,isLoadingCompuestos:p,errorCompuestos:u}=A(),{UM:m,isLoadingUM:f,errorUM:g}=I(),[s,x]=c.useState(null),[y,v]=c.useState([]),S=[{dataField:"id",width:90,caption:"ID",allowFiltering:!1,allowSearch:!1},{dataField:"autAplicacionId",caption:"Regulaciones",visible:!1},{dataField:"fechaVigencia",width:120,caption:"Vigencia",dataType:"date",format:"dd/MM/yyyy",validationRules:[{type:"required",message:"La fecha es obligatoria"}]},{dataField:"compuestoId",caption:"Compuesto",visible:!1,validationRules:[{type:"required",message:"El compuesto es obligatorio"}]},{dataField:"compuesto",caption:"Compuesto"},{dataField:"valorReferencia",caption:"Referencia",width:100,dataType:"number",format:{type:"fixedPoint",precision:3},editorOptions:{format:"#0.000"}},{dataField:"umId",caption:"UM",visible:!1,validationRules:[{type:"required",message:"El compuesto es obligatorio"}]},{dataField:"um",caption:"UM",width:90},{dataField:"norma",caption:"Norma"}],F={colCount:8,items:[{dataField:"id",colSpan:1,editorOptions:{disabled:!0}},{dataField:"compuestoId",colSpan:3,editorType:"dxSelectBox",editorOptions:{dataSource:y,displayExpr:"nombre",valueExpr:"id",searchEnabled:!0}},{dataField:"valorReferencia",caption:"Valor Referencia",colSpan:2},{dataField:"umId",colSpan:2,editorType:"dxSelectBox",editorOptions:{dataSource:m,displayExpr:"nombre",valueExpr:"id",searchEnabled:!0}},{dataField:"fechaVigencia",colSpan:2},{dataField:"norma",colSpan:4,editorOptions:{maxLength:45}}]};return a||p||f?t.jsx("div",{children:"Cargando datos..."}):r||u||g?t.jsx("div",{children:"Error al cargar datos (Regulaciones / Compuestos / UMs)"}):t.jsxs("div",{children:[t.jsx("div",{style:{marginBottom:"20px"},children:t.jsx(E,{dataSource:i,displayExpr:e=>e?`${e.provincia}:: ${e.nombre}  (${e.matriz})`:"",valueExpr:"id",label:"Seleccione una RegulaciÃ³n",labelMode:"outside",searchEnabled:!0,onValueChanged:e=>o(e.value)})}),s&&t.jsx(b,{title:"Compuestos Regulados",resource:"regulados",columns:S,keyExpr:"id",editable:!0,form:F,size:"medium",externalFilter:["autAplicacionId","=",s],onSaving:(e,n)=>M(e,n),onInitNewRow:e=>C(e,i,s)})]})}export{D as default};
