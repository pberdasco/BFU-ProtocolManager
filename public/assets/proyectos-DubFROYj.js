import{R as ie,T as De,n as P,e as Re,i as k,p as Te,h as Ie,g as $e,a as N,b as je,c as re,d as D,f as T,k as Y,s as He,l as Q,m as Ae,o as S,q as Fe,r as _,C as Me,j as g,F as ze,S as H,B as ae,t as B,u as X,v,A as Ve,D as I,w as ke,X as Be,G as j,x as L,y as Le,z as oe,E as w,H as F,I as Pe,J as Ne,K as Z,L as G,M as Ke,N as Ge,O as K,P as Oe,Q as qe,U as Ue,V as A,W as We,Y as Je,Z as Ye}from"./index-C37p9Lq4.js";import{D as le,E as de,P as Qe,T as ee,C as ce,a as ue,I as M}from"./data-grid-CEAYuK_4.js";import{T as Xe}from"./toast-BTJFKrW3.js";import{a as Ze,p as et}from"./m_utils.scroll-HIGYRNAS.js";import"./m_export-DeFelJNZ.js";const he=ie.createContext({});function pe(){return ie.useContext(he)}const fe=De.inherit({_getDefaultOptions(){return S(this.callBase(),{spellcheck:!0,minHeight:void 0,maxHeight:void 0,autoResizeEnabled:!1})},_initMarkup(){this.$element().addClass("dx-textarea"),this.callBase(),this.setAria("multiline","true")},_renderContentImpl(){this._updateInputHeight(),this.callBase()},_renderInput(){this.callBase(),this._renderScrollHandler()},_createInput(){const e=Ae("<textarea>");return this._applyInputAttributes(e,this.option("inputAttr")),this._updateInputAutoResizeAppearance(e),e},_setInputMinHeight:P,_renderScrollHandler(){this._eventY=0;const e=this._input(),t=et(e);D.on(e,T(He.init,this.NAME),t,P),D.on(e,T(Q.down,this.NAME),this._pointerDownHandler.bind(this)),D.on(e,T(Q.move,this.NAME),this._pointerMoveHandler.bind(this))},_pointerDownHandler(e){this._eventY=Y(e).y},_pointerMoveHandler(e){const t=Y(e).y,s=this._eventY-t;Ze(this._input(),s)&&(e.isScrollingEvent=!0,e.stopPropagation()),this._eventY=t},_renderDimensions(){const e=this.$element(),t=e.get(0),s=this._getOptionValue("width",t),n=this._getOptionValue("height",t),i=this.option("minHeight"),l=this.option("maxHeight");e.css({minHeight:i!==void 0?i:"",maxHeight:l!==void 0?l:"",width:s,height:n})},_resetDimensions(){this.$element().css({height:"",minHeight:"",maxHeight:""})},_renderEvents(){this.option("autoResizeEnabled")&&D.on(this._input(),T("input paste",this.NAME),this._updateInputHeight.bind(this)),this.callBase()},_refreshEvents(){D.off(this._input(),T("input paste",this.NAME)),this.callBase()},_getHeightDifference(e){return N(this._$element.get(0),!1)+N(this._$textEditorContainer.get(0),!1)+N(this._$textEditorInputContainer.get(0),!0)+je("height",re().getComputedStyle(e.get(0))).margin},_updateInputHeight(){if(!Ie())return;const e=this._input(),t=this.option("height"),s=t===void 0&&this.option("autoResizeEnabled");if(!(s||t===void 0&&this.option("minHeight"))){e.css("height","");return}this._resetDimensions(),this._$element.css("height",$e(this._$element)),e.css("height",0);const i=this._getHeightDifference(e);this._renderDimensions();const l=this._getBoundaryHeight("minHeight"),a=this._getBoundaryHeight("maxHeight");let c=e[0].scrollHeight;if(l!==void 0&&(c=Math.max(c,l-i)),a!==void 0){const p=a-i,m=c>p;c=Math.min(c,p),this._updateInputAutoResizeAppearance(e,!m)}e.css("height",c),s&&this._$element.css("height","auto")},_getBoundaryHeight(e){const t=this.option(e);if(k(t))return typeof t=="number"?t:Te(t,this.$element().get(0).parentElement,this._$element.get(0))},_renderInputType:P,_visibilityChanged(e){e&&this._updateInputHeight()},_updateInputAutoResizeAppearance(e,t){if(e){const s=Re(t,this.option("autoResizeEnabled"));e.toggleClass("dx-texteditor-input-auto-resize",s)}},_dimensionChanged(){this.option("visible")&&this._updateInputHeight()},_optionChanged(e){switch(e.name){case"autoResizeEnabled":this._updateInputAutoResizeAppearance(this._input(),e.value),this._refreshEvents(),this._updateInputHeight();break;case"value":case"height":this.callBase(e),this._updateInputHeight();break;case"minHeight":case"maxHeight":this._renderDimensions(),this._updateInputHeight();break;case"visible":this.callBase(e),e.value&&this._updateInputHeight();break;default:this.callBase(e)}}});Fe("dxTextArea",fe);/*!
 * devextreme-react
 * Version: 24.2.3
 * Build date: Fri Dec 06 2024
 *
 * Copyright (c) 2012 - 2024 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-react
 */_.memo(_.forwardRef((e,t)=>{const s=_.useRef(null);_.useImperativeHandle(t,()=>({instance(){var a;return(a=s.current)==null?void 0:a.getInstance()}}),[s.current]);const n=_.useMemo(()=>["value"],[]),i=_.useMemo(()=>["onChange","onContentReady","onCopy","onCut","onDisposing","onEnterKey","onFocusIn","onFocusOut","onInitialized","onInput","onKeyDown","onKeyUp","onPaste","onValueChanged"],[]),l=_.useMemo(()=>({defaultValue:"value"}),[]);return _.createElement(Me,{WidgetClass:fe,ref:s,subscribableOptions:n,independentEvents:i,defaults:l,...e})}));function tt({title:e="Entidad",cancelHandler:t=()=>{},saveHandler:s=()=>{},form:n={},columns:i={}}){const l=_.useRef(null),{state:a,action:c}=pe(),[p,m]=_.useState({visible:!1,message:"",type:"error"}),b=_.useCallback(o=>{o.cancel=!0,c({type:"Saving",payload:{data:o.changes[0],key:a.mainKey}})},[c]),h=_.useCallback(o=>{let y=!0;o.length&&(y=a.rowValidate(o[0]),y||m({visible:!0,message:"El campo tiene un error. Por favor, verifica los datos.",type:"error"})),c({type:"Set_Changes",payload:{changes:o,isValid:y}})},[c]),r=_.useCallback(o=>{c({payload:o,type:"Set_Key"})},[c]),d=_.useCallback(o=>{t(l,o),l.current.instance().cancelEditData()},[]),u=_.useCallback(o=>{s(l,o),l.current.instance().saveEditData()},[]),f=_.useCallback(o=>{if(o.parentType==="dataRow"){let y=a.rowValidate(o.row);c({type:"Set_Valid",payload:y})}},[c]);return g.jsxs("div",{id:"data-grid-demo",children:[g.jsxs(le,{dataSource:a.data,keyExpr:a.mainKey,showBorders:!0,onSaving:b,ref:l,onEditorPreparing:f,repaintChangesOnly:!0,children:[g.jsxs(de,{mode:"popup",changes:a.changes,onChangesChange:h,editRowKey:a.editRowKey,onEditRowKeyChange:r,allowAdding:!0,allowDeleting:!0,allowUpdating:!0,children:[g.jsxs(Qe,{showTitle:!0,title:"Editar Proyecto",width:1200,height:600,children:[g.jsx(ee,{component:()=>g.jsx(nt,{isValid:a.isValid,saveClickHandler:u}),location:"after",toolbar:"bottom"}),g.jsx(ee,{component:()=>g.jsx(st,{cancelClickHandler:d}),location:"after",toolbar:"bottom"})]}),g.jsxs(ze,{colCount:2,children:[g.jsx(H,{dataField:"codigo",colSpan:1}),g.jsx(H,{dataField:"nombre",colSpan:1,label:{text:"NOMBRE"}}),g.jsx(H,{dataField:"empresa",colSpan:2}),g.jsx(H,{dataField:"subproyectos",colSpan:2})]})]}),i.map((o,y)=>g.jsx(ce,{dataField:o.dataField,caption:o.caption,width:o.width,minWidth:o.minWidth,maxWidth:o.maxWidth,allowEditing:o.allowEditing,allowSorting:o.allowSorting,allowFiltering:o.allowFiltering,allowGrouping:o.allowGrouping,dataType:o.dataType,alignment:o.alignment,cellRender:o.cellRender,headerCellRender:o.headerCellRender,editCellComponent:o.editCellComponent,customizeText:o.customizeText,lookup:o.lookup,format:o.format,visible:o.visible,sortOrder:o.sortOrder,sortIndex:o.sortIndex,headerFilter:o.headerFilter,validationRules:o.validationRules,fixed:o.fixed,fixedPosition:o.fixedPosition,visibleIndex:o.visibleIndex,cssClass:o.cssClass,colSpan:o.colSpan,allowExporting:o.allowExporting},y)),g.jsxs(ue,{children:[g.jsx(M,{location:"before",html:`<div class="toolbar-title">${e}</div>`}),g.jsx(M,{name:"addRowButton"})]})]}),g.jsx(Xe,{visible:p.visible,message:p.message,type:p.type,displayTime:3e3,onHiding:()=>m({...p,visible:!1})})]})}function st({cancelClickHandler:e}){return g.jsx(ae,{text:"Cancel",onClick:e})}function nt({saveClickHandler:e,isValid:t}){return g.jsx(ae,{text:"Save",disabled:!t,onClick:e})}const $=re(),{abstract:te}=B,it=B.inherit({ctor(e,t){this._store=e,this._dirty=!!t.data,this.save();const s=this._immediate=t.immediate,n=Math.max(100,t.flushInterval||1e4);if(!s){const i=this.save.bind(this);setInterval(i,n),D.on($,"beforeunload",i),$.cordova&&X.listen(X.getDocument(),"pause",i,!1)}},notifyChanged(){this._dirty=!0,this._immediate&&this.save()},load(){this._store._array=this._loadImpl(),this._dirty=!1},save(){this._dirty&&(this._saveImpl(this._store._array),this._dirty=!1)},_loadImpl:te,_saveImpl:te}),rt=it.inherit({ctor(e,t){const{name:s}=t;if(!s)throw v.Error("E4013");this._key=`dx-data-localStore-${s}`,this.callBase(e,t)},_loadImpl(){const e=$.localStorage.getItem(this._key);return e?JSON.parse(e):[]},_saveImpl(e){e.length?$.localStorage.setItem(this._key,JSON.stringify(e)):$.localStorage.removeItem(this._key)}}),at={dom:rt};Ve.inherit({ctor(e){typeof e=="string"?e={name:e}:e=e||{},this.callBase(e),this._backend=new at[e.backend||"dom"](this,e),this._backend.load()},_clearCache(){this._backend.load()},clear(){this.callBase(),this._backend.notifyChanged()},_insertImpl(e){const t=this._backend;return this.callBase(e).done(t.notifyChanged.bind(t))},_updateImpl(e,t){const s=this._backend;return this.callBase(e,t).done(s.notifyChanged.bind(s))},_removeImpl(e){const t=this._backend;return this.callBase(e).done(t.notifyChanged.bind(t))}},"local");const ot=/^(\{{0,1}([0-9a-fA-F]){8}-([0-9a-fA-F]){4}-([0-9a-fA-F]){4}-([0-9a-fA-F]){4}-([0-9a-fA-F]){12}\}{0,1})$/,lt=/^\/Date\((-?\d+)((\+|-)?(\d+)?)\)\/$/,dt=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[-+]{1}\d{2}(:?)(\d{2})?)?$/,se="application/json;odata=verbose",z=e=>Ne(e)==="string"?e.split():e,ge=e=>/\./.test(e),O=(e,t,s)=>{for(e=String(e);e.length<t;)e=s?`${e}0`:`0${e}`;return e},W=(e,t,s)=>{const n=[],i=l=>O(l,2);return n.push(e.getFullYear()),n.push("-"),n.push(i(e.getMonth()+1)),n.push("-"),n.push(i(e.getDate())),t&&e.getHours()+e.getMinutes()+e.getSeconds()+e.getMilliseconds()<1||(n.push("T"),n.push(i(e.getHours())),n.push(":"),n.push(i(e.getMinutes())),n.push(":"),n.push(i(e.getSeconds())),e.getMilliseconds()&&(n.push("."),n.push(O(e.getMilliseconds(),3))),s||n.push("Z")),n.join("")},ct=e=>{const t=new Date(60*new Date(0).getTimezoneOffset()*1e3),s=e.replace("Z","").split("T"),n=/(\d{4})-(\d{2})-(\d{2})/.exec(s[0]),i=/(\d{2}):(\d{2}):(\d{2})\.?(\d{0,7})?/.exec(s[1]);if(t.setFullYear(Number(n[1])),t.setMonth(Number(n[2])-1),t.setDate(Number(n[3])),Array.isArray(i)&&i.length){t.setHours(Number(i[1])),t.setMinutes(Number(i[2])),t.setSeconds(Number(i[3]));let l=(i[4]||"").slice(0,3);l=O(l,3,!0),t.setMilliseconds(Number(l))}return t},ut=e=>/^(?:[a-z]+:)?\/{2,2}/i.test(e),ht=e=>{const t=e.indexOf("?");return t>-1?e.substr(0,t):e},pt=(e,t)=>{let s;const n=ht(e).split("/"),i=t.split("/");for(n.pop();i.length;)s=i.shift(),s===".."?n.pop():n.push(s);return n.join("/")},ft=e=>{const t=[];for(const s in e)t.push(`${s}=${e[s]}`);return t.join("&")},gt=function(e,t){var s;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};t=S({async:!0,method:"get",url:"",params:{},payload:null,headers:{},timeout:3e4},t),(s=n.beforeSend)===null||s===void 0||s.call(n,t);const{async:i,timeout:l,headers:a}=t;let{url:c,method:p}=t;const{jsonp:m,withCredentials:b}=n;p=(p||"get").toLowerCase();const h=p==="get",r=h&&m,d=S({},t.params),u=h?d:(f=t.payload,JSON.stringify(f,function(R,x){if(!(this[R]instanceof Date))return x;switch(x=W(this[R]),e){case 2:return x.substr(0,x.length-1);case 3:case 4:return x;default:throw v.Error("E4002")}}));var f;const o=!h&&ft(d),y=!h&&se;return o&&(c+=(c.indexOf("?")>-1?"&":"?")+o),r&&(u.$format="json"),{url:c,data:u,dataType:r?"jsonp":"json",jsonp:r&&"$callback",method:p,async:i,timeout:l,headers:a,contentType:y,accepts:{json:[se,"text/plain"].join()},xhrFields:{withCredentials:b}}},J=(e,t,s)=>{const{deserializeDates:n,fieldTypes:i,countOnly:l,isPaged:a}=s,c=new I,p=gt(e,t,s);return ke.sendRequest(p).always((m,b)=>{const r=yt(m,b,{deserializeDates:n,fieldTypes:i},p),{error:d,data:u,count:f}=r;let{nextUrl:o}=r;if(d)d.message!==Be&&c.reject(d);else if(l)isFinite(f)?c.resolve(f):c.reject(v.Error("E4018"));else if(o&&!a)ut(o)||(o=pt(p.url,o)),J(e,{url:o},s).fail(c.reject).done(y=>c.resolve(u.concat(y)));else{const y=isFinite(f)?{totalCount:f}:void 0;c.resolve(u,y)}}),c.promise()},mt=e=>{let t,s,n=e;if("message"in e){var i;t=((i=e.message)===null||i===void 0?void 0:i.value)||e.message}for(;(n=n.innererror||n.internalexception)&&(s=n.message,t=s??t,!(n.internalexception&&t.indexOf("inner exception")===-1)););return t},_t=(e,t,s)=>{var n,i,l,a;if(t==="nocontent")return null;let c="Unknown error",p=e,m=200;const b={requestOptions:s};if(t!=="success"){const{status:r,responseText:d}=e;m=r,c=Pe(e,t);try{p=JSON.parse(d)}catch{}}const h=((n=p)===null||n===void 0?void 0:n.then)||((i=p)===null||i===void 0?void 0:i.error)||((l=p)===null||l===void 0?void 0:l["odata.error"])||((a=p)===null||a===void 0?void 0:a["@odata.error"]);if(h){c=mt(h)||c,b.errorDetails=h,m===200&&(m=500);const r=Number(h.code);isFinite(r)&&r>=400&&(m=r)}return m>=400||m===0?(b.httpStatus=m,S(Error(c),b)):null},yt=(e,t,s,n)=>{const i=_t(e,t,n);if(i)return{error:i};if(!L(e))return{data:e};const l="d"in e&&(Array.isArray(e.d)||Le(e.d))?bt(e):vt(e);return me(l,s),l},bt=e=>{let{d:t}=e;return k(t)?{data:t.results??t,nextUrl:t.__next,count:parseInt(t.__count,10)}:{error:Error("Malformed or unsupported JSON response received")}},vt=e=>({data:e.value??e,nextUrl:e["@odata.nextLink"],count:parseInt(e["@odata.count"],10)}),C=B.inherit({ctor(e){this._value=e},valueOf(){return this._value}}),me=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};w(e,(s,n)=>{if(n!==null&&typeof n=="object")"results"in n&&(e[s]=n.results),me(e[s],t);else if(typeof n=="string"){const{fieldTypes:i,deserializeDates:l}=t;if((!i||i[s]!=="String")&&ot.test(n)&&(e[s]=new j(n)),l!==!1)if(lt.exec(n)){const c=new Date(Number(RegExp.$1)+60*RegExp.$2*1e3);e[s]=new Date(c.valueOf()+60*c.getTimezoneOffset()*1e3)}else dt.test(n)&&(e[s]=new Date(ct(e[s]).valueOf()))}})},wt=e=>`datetime'${W(e,!0,!0)}'`,xt=e=>`'${e.replace(/'/g,"''")}'`,E=e=>e instanceof C?e.valueOf():e.replace(/\./g,"/"),_e=e=>e instanceof Date?W(e,!1,!1):e instanceof j?e.valueOf():Array.isArray(e)?`[${e.map(t=>_e(t)).join(",")}]`:ye(e),ye=e=>e instanceof Date?wt(e):e instanceof j?`guid'${e}'`:e instanceof C?e.valueOf():typeof e=="string"?xt(e):String(e),V=(e,t)=>{switch(t){case 2:case 3:return ye(e);case 4:return _e(e);default:throw v.Error("E4002")}},Ct=(e,t)=>{if(L(e)){const s=[];return w(e,(n,i)=>s.push(`${E(n)}=${V(i,t)}`)),s.join()}return V(e,t)},St={String:e=>`${e}`,Int32:e=>Math.floor(e),Int64:e=>e instanceof C?e:new C(`${e}L`),Guid:e=>e instanceof j?e:new j(e),Boolean:e=>!!e,Single:e=>e instanceof C?e:new C(`${e}f`),Decimal:e=>e instanceof C?e:new C(`${e}m`)},q=(e,t)=>{if(t===null)return null;const s=St[e];if(!s)throw v.Error("E4014",e);return s(t)},be=(e,t)=>{if(t)return e<4?E(t.join()):oe(t,ge,!0).join()},ve=e=>{let t="";const s=[],n=[];return w(e,(i,l)=>{Array.isArray(l)&&[].push.apply(s,l),L(l)&&n.push(`${i}${ve(l)}`)}),(s.length||n.length)&&(t+="(",s.length&&(t+=`$select=${F(s,E).join()}`),n.length&&(s.length&&(t+=";"),t+=`$expand=${F(n,E).join()}`),t+=")"),t},Et=e=>{const t=[];return w(e,(s,n)=>t.push(`${s}${ve(n)}`)),t.join()},we=(e,t,s)=>{const n=s(t,e.shift(),e);n!==!1&&we(e,n,s)},ne=(e,t,s)=>w(e,(n,i)=>we(i.split("."),t,s)),Dt=(e,t)=>{const s={};return e&&w(z(e),function(){s[E(this)]=1}),t&&w(z(t),function(){const n=this.split(".");n.length<2||(n.pop(),s[E(n.join("."))]=1)}),F(s,(n,i)=>i).join()},Rt=(e,t)=>{const s={};if(e||t)return e&&ne(z(e),s,(n,i,l)=>(n[i]=n[i]||{},l.length?n[i]:!1)),t&&ne(oe(z(t),ge),s,(n,i,l)=>l.length?n[i]=n[i]||{}:(n[i]=n[i]||[],n[i].push(i),!1)),Et(s)},xe=(e,t,s)=>e<4?Dt(t,s):Rt(t,s),Ce=(e,t)=>Z("{0}({1})",e,F(t||{},(s,n)=>Z("{0}={1}",n,s)).join(",")),U=(e,t)=>{if(!e)return e;const s={};return w(e,(n,i)=>{s[n]=V(i,t)}),s},Tt=["contains","notcontains","startswith","endswith"],It=(()=>{let e,t,s;const n=h=>(r,d)=>`${r} ${h} ${d}`,i=(h,r)=>(d,u)=>{const f=[h,"("];return t&&(d=d.indexOf("tolower(")===-1?`tolower(${d})`:d,u=u.toLowerCase()),r?f.push(u,",",d):f.push(d,",",u),f.push(")"),f.join("")},l={"=":n("eq"),"<>":n("ne"),">":n("gt"),">=":n("ge"),"<":n("lt"),"<=":n("le"),startswith:i("startswith"),endswith:i("endswith")},a=S({},l,{contains:i("substringof",!0),notcontains:i("not substringof",!0)}),c=S({},l,{contains:i("contains"),notcontains:i("not contains")}),p=h=>{var r;h=qe(h);const d=h[1],u=h[0],f=s&&s[u];if(f&&(o=d,Tt.some(Ee=>Ee===o))&&f!=="String")throw new v.Error("E4024",d,u,f);var o;const R=(e===4?c:a)[d.toLowerCase()];if(!R)throw v.Error("E4003",d);let x=h[2];return(r=s)!==null&&r!==void 0&&r[u]&&(x=q(s[u],x)),R(E(u),V(x,e))},m=h=>{const r=[];let d,u;return w(h,function(f,o){if(Array.isArray(o)){if(r.length>1&&d!==u)throw new v.Error("E4019");r.push(`(${b(o)})`),d=u,u="and"}else u=Oe(this)?"and":"or"}),r.join(` ${d} `)},b=h=>Array.isArray(h[0])?m(h):Ge(h)?(r=>{const d=r[0],u=b(r[1]);if(d==="!")return`not (${u})`;throw v.Error("E4003",d)})(h):p(h);return(h,r,d,u)=>(s=d,t=u??G().oDataFilterToLower,e=r,b(h))})(),$t=e=>{let t=[];const s=[],n=e.expand;let i,l,a,c;const p=e.version||4,m=()=>l||a!==void 0,b=r=>{for(let d=0;d<r.length;d++)if(K(r[d])||Array.isArray(r[d])&&b(r[d]))return!0;return!1},h=()=>{const r={};if(c||(t.length&&(r.$orderby=t.join(",")),l&&(r.$skip=l),a!==void 0&&(r.$top=a),r.$select=be(p,i)||void 0,r.$expand=xe(p,n,i)||void 0),s.length){const d=s.length<2?s[0]:s,u=e==null?void 0:e.fieldTypes,f=e==null?void 0:e.filterToLower;r.$filter=It(d,p,u,f)}return c&&(r.$top=0),(e.requireTotalCount||c)&&(p!==4?r.$inlinecount="allpages":r.$count="true"),r};return{optimize:r=>{let d=-1;for(let f=0;f<r.length;f++)if(r[f].name==="select"){d=f;break}if(d<0||!K(r[d].args[0]))return;const u=r[1+d];!u||u.name!=="slice"||(r[1+d]=r[d],r[d]=u)},exec:r=>J(p,{url:r,params:S(h(),e==null?void 0:e.params)},{beforeSend:e.beforeSend,jsonp:e.jsonp,withCredentials:e.withCredentials,countOnly:c,deserializeDates:e.deserializeDates,fieldTypes:e.fieldTypes,isPaged:isFinite(a)}),multiSort(r){let d;if(m())return!1;for(let u=0;u<r.length;u++){const f=r[u][0],o=!!r[u][1];let y;if(typeof f!="string")return!1;y=E(f),o&&(y+=" desc"),d=d||[],d.push(y)}t=d},slice(r,d){if(m())return!1;l=r,a=d},filter(r){if(m()||(Array.isArray(r)||(r=[].slice.call(arguments)),b(r)))return!1;s.length&&s.push("and"),s.push(r)},select(r){if(i||K(r))return!1;Array.isArray(r)||(r=[].slice.call(arguments)),i=r},count:()=>c=!0}};Ke.odata=$t;class Se{constructor(t){t=t||{},this._url=String(t.url).replace(/\/+$/,""),this._beforeSend=t.beforeSend,this._jsonp=t.jsonp,this._version=t.version||4,this._withCredentials=t.withCredentials,this._deserializeDates=t.deserializeDates,this._filterToLower=t.filterToLower}sendRequest(t,s,n,i){return J(this.version,{url:t,method:s,params:n||{},payload:i},{beforeSend:this._beforeSend,jsonp:this._jsonp,withCredentials:this._withCredentials,deserializeDates:this._deserializeDates})}get version(){return this._version}get beforeSend(){return this._beforeSend}get url(){return this._url}get jsonp(){return this._jsonp}get filterToLower(){return this._filterToLower}}const jt="5d46402c-7899-4ea9-bd81-8b73c47c7683",Ht=(e,t)=>({[e]:t}),At=(e,t)=>{const s={};for(const n in e)s[n]=e[n];for(const n in t)n in s?s[n]!==t[n]&&v.log("W4001",n):s[n]=t[n];return s},Ft=Ue.inherit({ctor(e){this.callBase(e),this._requestDispatcher=new Se(e);let t=this.key(),{fieldTypes:s}=e,{keyType:n}=e;if(n){const i=typeof n=="string";t||(t=i?jt:Object.keys(n),this._legacyAnonymousKey=t),i&&(n=Ht(t,n)),s=At(s,n)}this._fieldTypes=s||{},this.version()===2?this._updateMethod="MERGE":this._updateMethod="PATCH"},_customLoadOptions:()=>["expand","customQueryParams"],_byKeyImpl(e,t){const s={};return t&&(s.$expand=xe(this.version(),t.expand,t.select)||void 0,s.$select=be(this.version(),t.select)||void 0),this._requestDispatcher.sendRequest(this._byKeyUrl(e),"GET",s)},createQuery(e){let t;const s={adapter:"odata",beforeSend:this._requestDispatcher.beforeSend,errorHandler:this._errorHandler,jsonp:this._requestDispatcher.jsonp,version:this._requestDispatcher.version,withCredentials:this._requestDispatcher._withCredentials,expand:e==null?void 0:e.expand,requireTotalCount:e==null?void 0:e.requireTotalCount,deserializeDates:this._requestDispatcher._deserializeDates,fieldTypes:this._fieldTypes};if(t=(e==null?void 0:e.urlOverride)??this._requestDispatcher.url,k(this._requestDispatcher.filterToLower)&&(s.filterToLower=this._requestDispatcher.filterToLower),e!=null&&e.customQueryParams){const n=U(e==null?void 0:e.customQueryParams,this.version());this.version()===4?t=Ce(t,n):s.params=n}return We(t,s)},_insertImpl(e){this._requireKey();const t=new I;return A(this._requestDispatcher.sendRequest(this._requestDispatcher.url,"POST",null,e)).done(s=>t.resolve(s&&!G().useLegacyStoreResult?s:e,this.keyOf(s))).fail(t.reject),t.promise()},_updateImpl(e,t){const s=new I;return A(this._requestDispatcher.sendRequest(this._byKeyUrl(e),this._updateMethod,null,t)).done(n=>G().useLegacyStoreResult?s.resolve(e,t):s.resolve(n||t,e)).fail(s.reject),s.promise()},_removeImpl(e){const t=new I;return A(this._requestDispatcher.sendRequest(this._byKeyUrl(e),"DELETE")).done(()=>t.resolve(e)).fail(t.reject),t.promise()},_convertKey(e){let t=e;const s=this._fieldTypes,n=this.key()||this._legacyAnonymousKey;if(Array.isArray(n)){t={};for(let i=0;i<n.length;i++){const l=n[i];t[l]=q(s[l],e[l])}}else s[n]&&(t=q(s[n],e));return t},_byKeyUrl(e){const t=this._requestDispatcher.url,s=this._convertKey(e);return`${t}(${encodeURIComponent(Ct(s,this.version()))})`},version(){return this._requestDispatcher.version}},"odata");B.inherit({ctor(e){this._requestDispatcher=new Se(e),this._errorHandler=e.errorHandler,w(e.entities||[],(t,s)=>{this[t]=new Ft(S({},e,{url:`${this._requestDispatcher.url}/${encodeURIComponent(s.name||t)}`},s))})},get(e,t){return this.invoke(e,t,"GET")},invoke(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"POST";s=s.toLowerCase();const n=new I;let i=`${this._requestDispatcher.url}/${encodeURIComponent(e)}`,l;return this.version()===4&&(s==="get"?(i=Ce(i,U(t,this.version())),t=null):s==="post"&&(l=t,t=null)),A(this._requestDispatcher.sendRequest(i,s,U(t,this.version()),l)).done(a=>{L(a)&&e in a&&(a=a[e]),n.resolve(a)}).fail(this._errorHandler).fail(Je).fail(n.reject),n.promise()},objectLink(e,t){const s=this[e];if(!s)throw v.Error("E4015",e);return k(t)?{__metadata:{uri:s._byKeyUrl(t)}}:null},version(){return this._requestDispatcher.version}});function Mt(e,{type:t,payload:s}){let n;switch(t){case"Saving":return s.data||(s.data={}),n=Ye(e.data,[s.data],{keyExpr:s.key}),{...e,data:n,detailData:null,changes:[],editRowKey:null};case"Set_Changes":return{...e,changes:s.changes,isValid:s.isValid};case"Set_Key":return{...e,editRowKey:s};case"Set_Valid":return{...e,isValid:s};default:return e}}function zt(){return[{id:1,codigo:"300115",nombre:"Proyecto 300115 actualizado 1",empresa:"PAE",subproyectos:[{id:4,codigo:"300115-04",notas:"exProyecto 197115",objetivo:"Vactor + GeoRadar",ubicacion:"Argentina - Neuquén - LLL",nombreLocacion:"Locación Norte"},{id:3,codigo:"300115-03",notas:"exProyecto 197115",objetivo:"GeoRadar",ubicacion:"Argentina - Neuquén - Vaca Muerta",nombreLocacion:"Locación Norte"}]},{id:3,codigo:"300119",nombre:"Proyecto 119 +",empresa:"Vista2",subproyectos:[{id:5,codigo:"300119-03",notas:null,objetivo:"Vactor",ubicacion:"Argentina",nombreLocacion:"Sur"}]}]}function Vt({data:e}){const{state:t,action:s}=pe(),n=t.changes,i=_.useMemo(()=>{var a,c;return(c=(a=n[0])==null?void 0:a.data)!=null&&c.subproyectos?n[0].data.subproyectos:e.data.subproyectos?[...e.data.subproyectos]:[]},[n,e]),l=_.useCallback(a=>{let c=!0;n.length===0?n.push({data:{subproyectos:i},key:t.editRowKey,type:"update"}):n[0].data.subproyectos=i,c=t.subRowValidate(n[0]),s({type:"Set_Changes",payload:{changes:n,isValid:c}})},[s,n,i,t.editRowKey,t.subRowValidate]);return g.jsx("div",{children:g.jsxs(le,{dataSource:i,onSaved:l,keyExpr:t.subKey,repaintChangesOnly:!0,width:1100,children:[t.subGridColumns.map((a,c)=>g.jsx(ce,{dataField:a.dataField,caption:a.caption,width:a.width,minWidth:a.minWidth,maxWidth:a.maxWidth,allowEditing:a.allowEditing,allowSorting:a.allowSorting,allowFiltering:a.allowFiltering,allowGrouping:a.allowGrouping,dataType:a.dataType,alignment:a.alignment,cellRender:a.cellRender,headerCellRender:a.headerCellRender,editCellComponent:a.editCellComponent,customizeText:a.customizeText,lookup:a.lookup,format:a.format,visible:a.visible,sortOrder:a.sortOrder,sortIndex:a.sortIndex,headerFilter:a.headerFilter,validationRules:a.validationRules,fixed:a.fixed,fixedPosition:a.fixedPosition,visibleIndex:a.visibleIndex,cssClass:a.cssClass,colSpan:a.colSpan,allowExporting:a.allowExporting},c)),g.jsxs(ue,{children:[g.jsx(M,{location:"before",html:`<div style="max-width: none; white-space: normal;" class="toolbar-title">${t.subGridTitle}</div>`}),g.jsx(M,{name:"addRowButton"})]}),g.jsx(de,{mode:"row",allowAdding:!0,allowDeleting:!0,allowUpdating:!0})]})})}const kt=e=>e.value?e.value.length.toString():"0",Bt=[{dataField:"id",caption:"ID",width:60,allowEditing:!1},{dataField:"codigo",caption:"Código",width:100,validationRules:[{type:"required"},{type:"stringLength",max:10}]},{dataField:"nombre",caption:"Nombre"},{dataField:"empresa",caption:"Empresa"},{dataField:"subproyectos",caption:"#Subproyectos",editCellComponent:Vt,customizeText:kt,allowSorting:!1,width:150}],Lt=[{dataField:"id",caption:"ID",width:60,visible:!1,allowEditing:!1},{dataField:"codigo",caption:"Código",validationRules:[{type:"required"}]},{dataField:"ubicacion",validationRules:[{type:"required"}]},{dataField:"nombreLocacion",validationRules:[{type:"required"}]},{dataField:"objetivo",validationRules:[{type:"required"}]}];function Pt(e){if(!e.data||Object.keys(e.data).length===0)return!0;const t=e.data.codigo.substring(0,6);return e.type==="insert"||e.isNewRow===!0?e.data.subproyectos?e.data.subproyectos.every(s=>s.codigo.startsWith(t)):!0:e.type==="update"&&e.data.subproyectos?e.data.subproyectos.every(s=>s.codigo.startsWith(t)):!0}function Nt(e){return console.log("subRowValidate",e.data),!0}const Kt={colCount:2,items:[{dataField:"codigo",colSpan:1,disabled:!0,editable:!1,label:{text:"Código"},visible:!1},{dataField:"nombre",colSpan:1,label:{text:"NOMBRE"}},{dataField:"empresa",colSpan:2,label:{text:"Empresa"}},{dataField:"subproyectos",colSpan:2,label:{text:"#Subproyectos"}}]};function Jt(){const e={data:zt(),disabled:!1,changes:[],detailData:null,editRowKey:null,isLoading:!1,isValid:!0,rowValidate:Pt,subRowValidate:Nt,subGridColumns:Lt,mainKey:"id",subKey:"id",subGridTitle:"Subproyectos"},[t,s]=_.useReducer(Mt,e),n={state:t,action:s},i=(a,c)=>{console.log("cancelHandler",c)},l=(a,c)=>{console.log("saveHandler",c)};return g.jsx(he.Provider,{value:n,children:g.jsx(tt,{title:"Proyectos",form:Kt,columns:Bt,cancelHandler:i,saveHandler:l})})}export{Jt as default};
