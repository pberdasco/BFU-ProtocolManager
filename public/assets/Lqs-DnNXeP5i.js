import{r as m,j as d}from"./index-Cm1k3WOj.js";import{G as g}from"./GenericGrid-C-ekPLuX.js";import{S as C}from"./select-box-4LBauQTq.js";import{u as z}from"./laboratorios-C5etl_zU.js";import{u as w}from"./metodos-BaRMbRPg.js";import{u as Q}from"./compuestos-Dak9RLOv.js";import{u as h}from"./matrices-Q8tWdPl2.js";import{u as j}from"./um-C4DC3yG0.js";import"./data-grid-BFs8E209.js";import"./m_export-0R763p3z.js";import"./apiResource-5P-thon0.js";import"./localization-BrGm2QGq.js";import"./excelExport-6a3b1BXt.js";import"./exceljs.min-l8QLPR3U.js";import"./export_merged_ranges_manager-LVo80yp1.js";import"./useQuery-CW2cZTZx.js";const O=(o,i)=>{o.data.laboratorioId=i,o.data.valorLQ=0},R=(o,i,r)=>{o.changes.length>0&&o.changes.forEach(t=>{if(t.type==="insert"||t.type==="update"){if(t.data.laboratorioId||(t.data.laboratorioId=i),t.data.compuestoId){const a=r.find(s=>s.id===t.data.compuestoId);a&&a.matrizCodigo&&(t.data.matrizId=a.matrizCodigo)}t.data.valorLQ&&(t.data.valorLQ=parseFloat(Number(t.data.valorLQ).toFixed(3)))}t.type==="remove"&&console.log("Eliminando elemento con key:",t.key)})},U=(o,i)=>{if(o.dataField==="compuestoId"&&o.parentType==="dataRow"){const r=o.editorOptions.onValueChanged;o.editorOptions.onValueChanged=t=>{o.component.cellValue(o.row.rowIndex,"compuestoId",t.value),o.component.updateDimensions();const a=i.find(s=>s.id===t.value);a!=null&&a.matrizCodigo&&(o.component.cellValue(o.row.rowIndex,"matrizId",a.matrizCodigo),o.component.repaint()),typeof r=="function"&&r(t)}}};function Z(){function o(e){L(a),I(e)}const{laboratorios:i,isLoadingLaboratorios:r,errorLaboratorios:t}=z(),{compuestos:a,isLoadingCompuestos:s,errorCompuestos:c}=Q(),{metodos:p,isloadingMetodos:b,errorMetodos:x}=w(),{UM:u,isLoadingUM:f,errorUM:v}=j(),{matrices:E,isloadingMatrices:S,errorMatrices:y}=h(),[l,I]=m.useState(null),[n,L]=m.useState([]),F=[{dataField:"id",caption:"ID",width:60},{dataField:"compuestoId",caption:"Compuesto",visible:!1,lookup:{dataSource:a,valueExpr:"id",displayExpr:"nombre"},validationRules:[{type:"required",message:"El compuesto es obligatorio"}]},{dataField:"compuesto",caption:"Compuesto"},{dataField:"metodoId",caption:"Método",visible:!1,lookup:{dataSource:p,valueExpr:"id",displayExpr:"nombre"},validationRules:[{type:"required",message:"El método es obligatorio"}]},{dataField:"metodo",caption:"Método"},{dataField:"valorLQ",caption:"Valor LQ",dataType:"number",format:{type:"fixedPoint",precision:5},editorOptions:{showSpinButtons:!0,format:"#0.000"},validationRules:[{type:"required"}]},{dataField:"UMId",caption:"UM",lookup:{dataSource:u,valueExpr:"id",displayExpr:"nombre"},validationRules:[{type:"required",message:"La unidad de medida es obligatoria"}],width:200},{dataField:"matrizId",caption:"Matriz",visible:!1,lookup:{dataSource:E,valueExpr:"codigo",displayExpr:"nombre"}},{dataField:"matriz",caption:"Matriz"}],M={colCount:8,items:[{dataField:"id",colSpan:1,editorOptions:{disabled:!0}},{dataField:"compuestoId",colSpan:3,editorType:"dxSelectBox",editorOptions:{dataSource:n,displayExpr:e=>e?`${e.nombre} - ${e.matriz}`:"",valueExpr:"id",searchEnabled:!0}},{dataField:"metodoId",colSpan:3,editorType:"dxSelectBox",editorOptions:{dataSource:p,displayExpr:"nombre",valueExpr:"id",searchEnabled:!0}},{dataField:"valorLQ",caption:"Valor LQ",colSpan:2},{dataField:"UMId",colSpan:2,editorType:"dxSelectBox",editorOptions:{dataSource:u,displayExpr:"nombre",valueExpr:"id",searchEnabled:!0}},{dataField:"matrizId",colSpan:2,editorOptions:{disabled:!0}}]};return r||s||f||S||b?d.jsx("div",{children:"Cargando datos..."}):t||c||v||y||x?d.jsx("div",{children:"Error al cargar datos (Laboratorios / Compuestos / UMs / Metodos)"}):d.jsxs("div",{children:[d.jsx("div",{style:{marginBottom:"20px"},children:d.jsx(C,{dataSource:i,displayExpr:e=>e?`${e.nombre} `:"",placeholder:"Seleccione un laboratorio",valueExpr:"id",label:"Seleccione un Laboratorio",labelMode:"outside",searchEnabled:!0,onValueChanged:e=>o(e.value)})}),l&&d.jsx(g,{title:"Valores de LQ",resource:"Lqs",columns:F,keyExpr:"id",editable:!0,form:M,size:"medium",externalFilter:["laboratorioId","=",l],onInitNewRow:e=>O(e,l),onSaving:e=>R(e,l,n),onEditorPreparing:e=>U(e,n)})]})}export{Z as default};
